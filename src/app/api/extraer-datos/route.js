import { NextResponse } from 'next/server';
import OpenAI from 'openai';
import { promptContext } from '../../../../public/prompt';

const openai = new OpenAI({
  apiKey: process.env.CHAT_GPT_KEY, // Tu clave debe estar en .env.local
});

export async function POST(req) {
  try {
    const { body } = await req.json();
    if (!body || typeof body !== 'string') {
      return NextResponse.json({ error: 'Prompt inválido' }, { status: 400 });
    }

    const completion = await openai.chat.completions.create({
      model: 'gpt-4.1',
      messages: [
        {
          "role": "system",
          "content": [
            {
              "type":"text",
              "text": "Eres un asistente experto en análisis de cartas informativas de hechos delictivos. Tu tarea es leer atentamente la carta policial y devolver un **objeto JSON válido**, extrayendo la información clave solicitada.\nA continuacion, te doy una lista de datos que tendras que usar para comparar y extraer algunos datos y luego te especifico que datos extraer y como hacerlo."
            }
          ]
        },
        {
          "role": "system",
          "content": [
            {
              "type":"text",
              "text": "lista de dependencias:\n\nCOMISARIA VECINAL 1A\nCOMISARIA VECINAL 1B\nCOMISARIA VECINAL 1B ANEXO\nCOMISARIA VECINAL 1C\nCOMISARIA VECINAL 1C ANEXO\nCOMISARIA VECINAL 1D\nCOMISARIA VECINAL 1E\nCOMISARIA VECINAL 1F\nCOMISARIA VECINAL 2A\nCOMISARIA VECINAL 2B\nCOMISARIA VECINAL 3A\nCOMISARIA VECINAL 3A ANEXO\nCOMISARIA VECINAL 3B\nCOMISARIA VECINAL 3C\nCOMISARIA VECINAL 4A\nCOMISARIA VECINAL 4B\nCOMISARIA VECINAL 4C\nCOMISARIA VECINAL 4D\nCOMISARIA VECINAL 4D ANEXO\nCOMISARIA VECINAL 5A\nCOMISARIA VECINAL 5B\nCOMISARIA VECINAL 6A\nCOMISARIA VECINAL 6B\nCOMISARIA VECINAL 7A\nCOMISARIA VECINAL 7B\nCOMISARIA VECINAL 7C\nCOMISARIA VECINAL 8A\nCOMISARIA VECINAL 8B\nCOMISARIA VECINAL 8C\nCOMISARIA VECINAL 9A\nCOMISARIA VECINAL 9B\nCOMISARIA VECINAL 9C\nCOMISARIA VECINAL 10A\nCOMISARIA VECINAL 10B\nCOMISARIA VECINAL 10C\nCOMISARIA VECINAL 11A\nCOMISARIA VECINAL 11B\nCOMISARIA VECINAL 11B ANEXO\nCOMISARIA VECINAL 12A\nCOMISARIA VECINAL 12B\nCOMISARIA VECINAL 12C\nCOMISARIA VECINAL 13A\nCOMISARIA VECINAL 13B\nCOMISARIA VECINAL 13C\nCOMISARIA VECINAL 14A\nCOMISARIA VECINAL 14B\nCOMISARIA VECINAL 14C\nCOMISARIA VECINAL 15A\nCOMISARIA VECINAL 15B\nCOMISARIA VECINAL 15C\nDIVISION CAPTURA Y PROFUGOS\nDIVISION CONTRAVENCIONES Y FALTAS CONTRA EL ORDEN PUBLICO\nDIVISION DEFRAUD Y ESTAFAS\nDIVISION DELITOS CONTRA LA INTEGRIDAD SEXUAL\nDIVISION DELITOS CONTRA GRUPOS VULNERABLES\nDIVISION DELITOS CONTRA LA SALUD Y SEGURIDAD PERSONAL\nDIVISION HOMICIDIOS\nDIVISION INFANCIA Y ADOLESCENCIA\nDIVISION INVESTIGACIONES DE ORGANIZACIONES CRIMINALES\nDIVISION INV DEL ROBO ORG- PFA\nDIVISION PERSONAS EXTRAVIADAS\nDIVISION ROBOS Y HURTOS NORTE\nDIVISION ROBOS Y HURTOS SUR\nDIVISION SUSTRACCION DE AUTOMOTORES Y AUTOPARTES\nDIVISION INVESTIGACIONES COMUNALES 1 NORTE\nDIVISION INVESTIGACIONES COMUNALES 1 SUR\nDIVISION INVESTIGACIONES COMUNALES 2\nDIVISION INVESTIGACIONES COMUNALES 3\nDIVISION INVESTIGACIONES COMUNALES 4\nDIVISION INVESTIGACIONES COMUNALES 5\nDIVISION INVESTIGACIONES COMUNALES 6\nDIVISION INVESTIGACIONES COMUNALES 7\nDIVISION INVESTIGACIONES COMUNALES 8\nDIVISION INVESTIGACIONES COMUNALES 9\nDIVISION INVESTIGACIONES COMUNALES 10\nDIVISION INVESTIGACIONES COMUNALES 11\nDIVISION INVESTIGACIONES COMUNALES 12\nDIVISION INVESTIGACIONES COMUNALES 13\nDIVISION INVESTIGACIONES COMUNALES 14\nDIVISION INVESTIGACIONES COMUNALES 15\nDEPARTAMENTO ANTISECUESTROS NORTE - PFA\nDEPARTAMENTO ANTISECUESTROS SUR - PFA\nDEPARTAMENTO INTELIGENCIA CONTRA EL CRIMEN ORGANIZADO - PFA\nSECCION ROBO DE MERCADERIA EN TRANSITO\nUFECRI\nDDI LA MATANZA\nDIVISIONES INVESTIGACIONES ESPECIALES\nCOMISARIA VICENTE LOPEZ 5TA\nDEPARTAMENTAL DE ESCOBAR\nDDI ESCOBAR\nCOMISARIA 3RA SAN FERNANDO\nDDI LANUS\nPOLICIA LOCAL LANUS\nDDI BERAZATEGUI\nDDI AVELLANEDA-LANUS\nDIVISION CONTRAVENCIONES Y FALTAS EVENTOS MASIVOS\nUOCNIDG1 DEL ESTE PSA\nDIVISION FALSIFICACION DE MONEDA PFA\nDICCO PFA\nDIVISION ANTIFRAUDES PFA\nDIVISION ANTIRERRORISMO"
            }
          ]
        },
        {
          "role": "system",
          "content": [
            {
              "type":"text",
              "text": "lista de justicias interventoras:\n\nFiscalía Nacional en lo Criminal y Correccional N° 1\nFiscalía Nacional en lo Criminal y Correccional N° 2\nFiscalía Nacional en lo Criminal y Correccional N° 3\nFiscalía Nacional en lo Criminal y Correccional N° 4\nFiscalía Nacional en lo Criminal y Correccional N° 5\nFiscalía Nacional en lo Criminal y Correccional N° 6\nFiscalía Nacional en lo Criminal y Correccional N° 7\nFiscalía Nacional en lo Criminal y Correccional N° 8\nFiscalía Nacional en lo Criminal y Correccional N° 9\nFiscalía Nacional en lo Criminal y Correccional N° 10\nFiscalía Nacional en lo Criminal y Correccional N° 11\nFiscalía Nacional en lo Criminal y Correccional N° 12\nFiscalía Nacional en lo Criminal y Correccional N° 13\nFiscalía Nacional en lo Criminal y Correccional N° 14\nFiscalía Nacional en lo Criminal y Correccional N° 15\nFiscalía Nacional en lo Criminal y Correccional N° 16\nFiscalía Nacional en lo Criminal y Correccional N° 17\nFiscalía Nacional en lo Criminal y Correccional N° 18\nFiscalía Nacional en lo Criminal y Correccional N° 19\nFiscalía Nacional en lo Criminal y Correccional N° 20\nFiscalía Nacional en lo Criminal y Correccional N° 21\nFiscalía Nacional en lo Criminal y Correccional N° 22\nFiscalía Nacional en lo Criminal y Correccional N° 23\nFiscalía Nacional en lo Criminal y Correccional N° 24\nFiscalía Nacional en lo Criminal y Correccional N° 25\nFiscalía Nacional en lo Criminal y Correccional N° 26\nFiscalía Nacional en lo Criminal y Correccional N° 27\nFiscalía Nacional en lo Criminal y Correccional N° 28\nFiscalía Nacional en lo Criminal y Correccional N° 29\nFiscalía Nacional en lo Criminal y Correccional N° 30\nFiscalía Nacional en lo Criminal y Correccional N° 31\nFiscalía Nacional en lo Criminal y Correccional N° 32\nFiscalía Nacional en lo Criminal y Correccional N° 34\nFiscalía Nacional en lo Criminal y Correccional N° 35\nFiscalía Nacional en lo Criminal y Correccional N° 36\nFiscalía Nacional en lo Criminal y Correccional N° 37\nFiscalía Nacional en lo Criminal y Correccional N° 38\nFiscalía Nacional en lo Criminal y Correccional N° 39\nFiscalía Nacional en lo Criminal y Correccional N° 40\nFiscalía Nacional en lo Criminal y Correccional N° 41\nFiscalía Nacional en lo Criminal y Correccional N° 42\nFiscalía Nacional en lo Criminal y Correccional N° 43\nFiscalía Nacional en lo Criminal y Correccional N° 44\nFiscalía Nacional en lo Criminal y Correccional N° 45\nFiscalía Nacional en lo Criminal y Correccional N° 46\nFiscalía Nacional en lo Criminal y Correccional N° 47\nFiscalía Nacional en lo Criminal y Correccional N° 48\nFiscalía Nacional en lo Criminal y Correccional N° 49\nFiscalía Nacional en lo Criminal y Correccional N° 50\nFiscalía Nacional en lo Criminal y Correccional N° 51\nFiscalía Nacional en lo Criminal y Correccional N° 52\nFiscalía Nacional en lo Criminal y Correccional N° 53\nFiscalía Nacional en lo Criminal y Correccional N° 54\nFiscalía Nacional en lo Criminal y Correccional N° 55\nFiscalía Nacional en lo Criminal y Correccional N° 56\nFiscalía Nacional en lo Criminal y Correccional N° 57\nFiscalía Nacional en lo Criminal y Correccional N° 58\nFiscalía Nacional en lo Criminal y Correccional N° 59\nFiscalía Nacional en lo Criminal y Correccional N° 60\nFiscalía Nacional en lo Criminal y Correccional N° 61\nFiscalía Nacional en lo Criminal y Correccional N° 62\nFiscalía de Distrito de los Barrios de Saavedra y Nuñez\nFiscalía de Distrito del Barrio de la Boca\nUFECRI"
            }
          ]
        },
        {
          "role": "system",
          "content": [
            {
              "type":"text",
              "text": "lista de modalidades:\nABUSO SEXUAL\nAV. ILICITO\nAV. SUICIDIO\nCHOQUE Y LESIONES\nESTAFA (CUENTO DEL TÍO)\nESTAFA VIRTUAL\nEVASION\nHALLAZGO\nHERIDO DE ARMA (BLANCA / FUEGO)\nHOMICIDIO\nHURTO\nHURTO AGRAVADO FINCA / COMERCIO\nHURTO AGRAVADO VEHIC. VIA PUB. (HILUX)\nHURTO AGRAVADO VEHIC. VIA PUB. (SW4)\nHURTO AGRAVADO VEHICULOS\nINCENDIO CONTENEDOR\nINFRACCION LEY Nº 23737\nLESIONES GRAVES\nOTROS (ACLARAR EN RESEÑA)\nPARADERO\nROBO AMA\nROBO AMA AUTOMOTOR\nROBO ARREBATO\nROBO AUTOMOTOR\nROBO AUTOPARTES\nROBO EN AUSENCIA\nROBO EN AUSENCIA (COMERCIO)\nROBO EN COMERCIO (SIN ARMAS)\nROBO EN FINCA\nROBO EN FINCA (POR ESCALAMIENTO)\nROBO MOTOCHORRO\nROBO MOTOCHORRO (ROLERO)\nROBO POBLADO Y EN BANDA\nROBO Y LESIONES\nROBO Y PIL (MERC. EN TRANSITO)\nROBO Y PIL (INT. COMERCIO)\nROBO Y PIL (INT. FINCA)\nSALIDERA BANCARIA\nSECUESTRO EXTORSIVO\nSIN EFECTO\nTRATA DE PERSONAS\nTTVA. HOMICIDIO\nTTVA. ROBO / HURTO\nVIUDA NEGRA\nVIUDA NEGRA CON OBITO"
            }
          ]
        },
        {
          "role": "system",
          "content": [
            {
              "type":"text",
              "text": "📌 **Instrucciones**:\n1. Extrae todos los campos indicados.\n2. Si alguno no aparece en la carta, coloca un guion (\"-\").\n3. **Los campos que dependen de listas deben seleccionarse exactamente como están en las listas provistas**.\n4. Devuelve solo un objeto JSON. **Sin explicación, sin texto adicional ni saltos de línea innecesarios.**\n\n🔍 **Campos requeridos**:\n- **number**: número o código del suceso.\n- **eventDate**: solo en formato aaaa-mm-dd.\n- **callTime**: hora del llamado (formato hh:mm:ss).\n**modalitie**:tipo de hecho delictivo, concatena el tipo con el subtipo de hecho y selecciona uno de la lista de modalidades, si no coincide agregar un string vacio.\n- **jurisdiction**: seleccionar una opción exacta de la lista de dependencias.\n-**justice**: si menciona justicia que labro actuaciones, seleccionar una de la lista de justicias interventoras, si no esta en la lista colocala respetando mayusculas y minusculas, si no menciona devolver un string vacio.\n-**fiscal**: si menciona fiscal a cargo de las actuaciones, agregarlo respetando mayusculas y minusculasm, con el prefijo Dr. o Dra. , si no menciona devolver un string vacio.\n-**secretariat**:  si menciona secretaria a cargo de las actuaciones, agregarlo respetando mayusculas y minusculasm, con el prefijo Dr. o Dra. , si no menciona devolver un string vacio.\n- **direction**: calle y altura o intersección (sin barrio ni ciudad, siguiendo el siguiente formato: calle altura o calle e interseccion, por ejemplo: Av. Rivadavia 1050), mayúsculas y minúsculas respetando la gramática.\n- **review**:\n  - El texto debe estar redactado con mayúsculas y minúsculas respetando la gramática (por ejemplo: nombres propios, artículos, abreviaciones como “Dr.” o “a/c”, etc.).\n  - No escribir todo el texto en mayúsculas.\n  - El texto completo debe estar redactado como un parte policial, con precisión y estilo formal.\n  - Relato detallado con términos policiales.\n  - Mencionar autores, características físicas, accionar, vehículos, objetos sustraídos.\n  - Mencionar cámaras del cmu (centro de monitoreo urbano o camaras privadas) y horarios individualizados por camara solo si aportaron información relevante.\n  - Finalizar con la actuación de la fiscalía si corresponde (colocarla completa)."
            }
          ]
        },
        {
          "role": "system",
          "content": [
            {
              "type":"text",
              "text": "\n🧾 **Ejemplo de salida esperada**:\n{\n  \"number\": \"45145678\",\n  \"eventDate\": \"13-05-2025\",\n  \"callTime\": \"22:30\",\n  \"jurisdiction\": \"COMISARIA VECINAL 9B\",\n  \"direction\": \"AV. RIVADAVIA 10100\",\n \"justice\":\"Fiscalía Nacional en lo Criminal y Correccional N° 1\",\n \"fiscal\":\"Dr. Ramirez\",\n \"secretariat\":\"Dra. Rosales\",\n  \"review\": \"Personal policial entrevista a la damnificada Jennifer Laura Glibbery, quien refería en primer instancia que se lesionó ambas manos con una botella de vidrio. Posteriormente, expresa que habría sido privada de la libertad por un masculino que la subió a un vehículo Ecosport blanco dominio AC295UC, del que no recuerda características, y que habría provocado la lesión con un objeto que no logró reconocer. La damnificada se encontraba en estado de alcoholemia. El hecho fue registrado por cámara CONSTITUCION08 donde se observa la llegada, descenso y posterior traslado de la femenina asistida por SAME a HTAL Penna con diagnóstico de herida cortante en mano derecha. Participaron imputados: 1) Omar (nacionalidad peruana), 2) Ezequiel Andrés Rodríguez (ex pareja). Se solicitó al CMU el seguimiento por cámaras aledañas y línea de tiempo. Se observa al masculino descendiendo del rodado e ingresando al Hotel Rind y Narciso, habitación 202. Cuatro móviles policiales en el lugar. No se informa actuación específica de fiscalía.\"\n}\n🧾si no es un texto relacionado a un hecho delicitvo que contenga lo solicitado devolver lo siguiente:\n{\n  message: \"El archivo no es un suceso delictivo\"\n}"
            }
          ]
        },
        {
          "role": "system",
          "content": [
            {
              "type":"text",
              "text": "Fecha Emisión Reporte:   08/05/2025 04:50:57\n Registro Histórico Suceso 45113573  \nDatos Generales\n MJYS   Usuario:   20304958198\n Período Desde:   07-05-2025 15:41:52   Período Hasta:   07-05-2025 19:12:57\n Datos del Suceso\n Número:   45113573   Tipo:   ROBO   Subtipo:   RECIENTE/CONSUMADO   Relevante:   NO\n Relato:   MASCULINO REFIERE QUE A SU CLIENTE, PERSONAL POLICIAL LE HABRIAN ROBADO BOLSO CON SU ARMA REGLAMENTARIA DE LA CAMIONETA\nDOMINIO AG071IZ. LE HABRIAN INHIBIDO LA SEÑAL DE LA MISMA __DATOS DEL PERSONAL POLICIAL: LP 129448 GABRIEL ROBERTO SANTILLAN OF\nMAYOR ORECHT\n Telefono:   1165138412\n Dirección:   AV RIVADAVIA AL 10615, CAPITAL FEDERAL, CIUDAD AUTONOMA BUENOS AIRES\n Fecha:   07-05-2025 03:46:52 PM   Victimas:   --   Recursos:   2    \n Mapa Recorrido\nCartas\n Agencia:   SUPERVISOR 911\n Estado:   CERRADO   Inicio:   07-05-25 15:50   Fin:   07-05-25 16:16   Operador:   CAACUÑA\n Prioridad:   MEDIA   Resultado:   CARTA NOTIFICADA   Despachador:   NLGONZALEZ   Recursos:   0\n Tipo/Subtipo:   ROBO/RECIENTE/CONSUMADO\n Agencia:   CMU CABA\n Estado:   CERRADO   Inicio:   07-05-25 15:50   Fin:   07-05-25 19:07   Operador:   CAACUÑA\n Prioridad:   MEDIA   Resultado:   CARTA NOTIFICADA   Despachador:   JALBRECH   Recursos:   0\n Tipo/Subtipo:   ROBO/RECIENTE/CONSUMADO\n Agencia:   COMUNA 9\n Estado:   CERRADO   Inicio:   07-05-25 15:50   Fin:   07-05-25 18:22   Operador:   CAACUÑA\n Prioridad:   MEDIA   Resultado:   ACT. POR HURTO   Despachador:   RBARCELONA   Recursos:   2\n Tipo/Subtipo:   ROBO/RECIENTE/CONSUMADO\n Agencia:   COORDINACION DGE\n Estado:   CERRADO   Inicio:   07-05-25 15:50   Fin:   07-05-25 16:26   Operador:   CAACUÑA\n Prioridad:   MEDIA   Resultado:   CARTA NOTIFICADA   Despachador:   GAHERMES   Recursos:   0\n Tipo/Subtipo:   ROBO/RECIENTE/CONSUMADO\n Agencia:   JEFE DE SERVICIOS\n Estado:   CERRADO   Inicio:   07-05-25 15:50   Fin:   07-05-25 17:21   Operador:   CAACUÑA\n Prioridad:   MEDIA   Resultado:   CARTA NOTIFICADA   Despachador:   MCABALLERO   Recursos:   0\n Tipo/Subtipo:   ROBO/RECIENTE/CONSUMADO\n Agencia:   ENCARGADO DE GUARDIA\n Estado:   CERRADO   Inicio:   07-05-25 15:50   Fin:   07-05-25 17:04   Operador:   CAACUÑA\n Prioridad:   MEDIA   Resultado:   CARTA NOTIFICADA   Despachador:   MCABALLERO   Recursos:   0\n Tipo/Subtipo:   ROBO/RECIENTE/CONSUMADO\n Agencia:   VIDEO\n Estado:   CERRADO   Inicio:   07-05-25 15:50   Fin:   07-05-25 18:05   Operador:   CAACUÑA\n Prioridad:   MEDIA   Resultado:   CARTA NOTIFICADA   Despachador:   JIMARTINEZ   Recursos:   0\n Tipo/Subtipo:   ROBO/RECIENTE/CONSUMADO\n Recursos\n Nombre   Descripción   Asignado   Arribó   Liberado   Código\n --   HT169   07-05 03:51   07-05 03:52   07-05 06:05   COD 2\n --   609B ( CV09B (7828) )   07-05 03:56   07-05 06:05   COD 2\n Eventos del Suceso\n Fecha   Operador   Evento   Descripción\n MASCULINO REFIERE QUE A SU CLIENTE, PERSONAL POLICIAL\nLE HABRIAN ROBADO BOLSO CON SU ARMA REGLAMENTARIA\n 07/05 15:46:52   caacuña   INICIO DE LLAMADA DE LA CAMIONETA DOMINIO AG071IZ. LE HABRIAN INHIBIDO LA\nSEÑAL DE LA MISMA __DATOS DEL PERSONAL POLICIAL: LP\n129448 GABRIEL ROBERTO SANTILLAN OF MAYOR ORECHT\n 07/05 15:48:53   caacuña   FIN LLAMADA\nDerivado por [caacuña] a [COORDINACION DGE],[COMUNA 9],\n 07/05 15:50:22   caacuña   DERIVACION DE SUCESO  \n[CMU CABA],[SUPERVISOR 911]\n 07/05 15:50:28   alfumilla   INICIO DESPACHO   COMUNA 9\n 07/05 15:50:29   nlgonzalez   INICIO DESPACHO   SUPERVISOR 911\n 07/05 15:51:12   jalbrech   INICIO DESPACHO   CMU CABA\n 07/05 15:51:13   vlbogado   COMPARTIR SUCESO   Compartido desde [COMUNA 9] a [JEFE DE SERVICIOS]\n 07/05 15:51:36   alfumilla   ASIGNACION DE RECURSO   Recurso [HT169 (HANDY)] asignado. Desplazamiento: COD 2\n07/05 15:51:43   vlbogado   REITERACION DE SUCESO   Reiterado desde [COMUNA 9] a [JEFE DE SERVICIOS]\n 07/05 15:52:23   gahermes   INICIO DESPACHO   COORDINACION DGE\nSE TOMO CONTACTO CON EL LLAMANTE INF QUE AGUARDA\n 07/05 15:52:44   vlbogado   COMENTARIO  \nPERSONAL EN EL INT DE COMERCIO DE NOMBRE QR MOTOS\n 07/05 15:52:48   vlbogado   MOVIL ARRIBA A SUCESO   Recurso [HT169 (HANDY)] arriba a suceso\n 07/05 15:53:06   nlgonzalez   REITERACION DE SUCESO   Reiterado desde [SUPERVISOR 911] a [JEFE DE SERVICIOS]\nCompartido desde [SUPERVISOR 911] a [ENCARGADO DE\n 07/05 15:53:06   nlgonzalez   COMPARTIR SUCESO  \nGUARDIA]\n 07/05 15:53:15   gahermes   REITERACION DE SUCESO   Reiterado desde [COORDINACION DGE] a [JEFE DE SERVICIOS]\nCMU INF CAMARA LINIERS21 CAM01/CAM02 AL MOMENTO NO\n 07/05 15:55:28   jalbrech   COMENTARIO  \nSE VISUALIZA LO APORTADO\n 07/05 15:55:48   mcaballero   INICIO DESPACHO   JEFE DE SERVICIOS\n Móvil [609B (CV09B (7828))] Personal [ INS: MALDONADO,\n 07/05 15:56:52   vlbogado   ASIGNACION DE MOVIL NAHUEL NAZARENO; OF1: LASCANO, MA] asignado.\nDesplazamiento: COD 2\nHT INF AUTORES A BORDO DE KANGOO DE COLOR GRIS SE DA\n 07/05 15:58:47   alfumilla   COMENTARIO  \nALA FUGA SENTIDO A VILLA LURO .-\n HT AMPLIA NEGATIVO ROBO DE ARMA REGLAMENTARIA Y\n 07/05 16:00:25   alfumilla   COMENTARIO UNIFORME DE ESTA INSTITUCION .- SUSTRAEN BOLSO CON\nPERTENENCIAS VARIAS .-\n Apellido: SANTILLAN - Nombre: Gabriel Roberto - Alias: - Sexo:\n 07/05 16:02:36   alfumilla   ALTA DE PERSONA MASCULINO - Edad: 58 - DNI: 18171020 - Fecha Nac: 1967.04.21 -\nImplicacion: Damnificado/a - LP: 0 - Observaciones:\n HT INF SE TRATA DE PERSONAL POLICIAL DE ESTA\n 07/05 16:04:22   vlbogado   COMENTARIO INSTITUCION RETIRADO , QUIEN INF QUE SE SUSTRAEN UNA\nGLOCK NUM DE SERIE SA435\n 07/05 16:05:36   mcaballero   INICIO DESPACHO   ENCARGADO DE GUARDIA\n 07/05 16:07:58   mcaballero   COMENTARIO   SE NOTIFICO A JEFATURA RECIBE INSPECTOR MARTINEZ\nHT AMPLIA EL KANGOO DE COLOR GRIS SIN CHAPA PATENTE\n 07/05 16:11:20   alfumilla   COMENTARIO  \nCOLOCADA CON PORTAEQUIPAJE .-\n Agencia: SUPERVISOR 911 Tipo/Subtipo: ROBO\n 07/05 16:16:31   gsaborido   CIERRE DESPACHO (RECIENTE/CONSUMADO) Prioridad: MEDIA Resultado de cierre:\nCARTA NOTIFICADA\n Agencia: COORDINACION DGE Tipo/Subtipo: ROBO\n 07/05 16:26:06   gahermes   CIERRE DESPACHO (RECIENTE/CONSUMADO) Prioridad: MEDIA Resultado de cierre:\nCARTA NOTIFICADA\nHT INDICA SE TRATA DE PERSONAL POLICIAL RETIRADO DE\n 07/05 16:32:48   alfumilla   COMENTARIO  \nPOLICIA DE LA CIUDAD .-\n CMU AMPLIA QUE SE VERIFICO LA LINEA DE TIEMPO DE LA\n 07/05 16:36:26   vmartinez   COMENTARIO CAMARA LINIERS11 Y LINERS23 NO LOGRANDO CAPTAR\nIMAGEN RELEVANTE PARA AMPLIAR\n Agencia: ENCARGADO DE GUARDIA Tipo/Subtipo: ROBO\n 07/05 17:04:26   mcaballero   CIERRE DESPACHO (RECIENTE/CONSUMADO) Prioridad: MEDIA Resultado de cierre:\nCARTA NOTIFICADA\n Agencia: JEFE DE SERVICIOS Tipo/Subtipo: ROBO\n 07/05 17:21:28   ahvalor   CIERRE DESPACHO (RECIENTE/CONSUMADO) Prioridad: MEDIA Resultado de cierre:\nCARTA NOTIFICADA\n 07/05 17:26:50   ctoralesferreira   COMENTARIO   SE SOLICITA NOVEDADES ,\n 07/05 17:32:36   dcorrea   COMENTARIO   SE SOLICITAN NOVEDADES\n 07/05 17:32:50   dcorrea   REITERACION DE SUCESO   Reiterado desde [COMUNA 9] a [CMU CABA]\n 07/05 17:32:51   dcorrea   COMPARTIR SUCESO   Compartido desde [COMUNA 9] a [VIDEO]\n 07/05 17:33:20   jimartinez   INICIO DESPACHO   VIDEO\nVIDEO INFORMA SE POSEE CAMARAS LINIERS 11 Y 23 CAMARA\n 07/05 17:34:29   jimartinez   COMENTARIO  \nFIJAS\n 07/05 17:43:51   dcorrea   COMENTARIO   SE SOLICITAN NOVEDADES\nM609 B ID 2009205 INDICA QUE RETRANSMITE SOLICITUD DE\n07/05 17:44:11   dcorrea   COMENTARIO  \nNOVEDADES\n Dominio: AG071EZ - Marca: Renault - Modelo: OROCH EMOTION\n 07/05 18:02:53   rbarcelona   ALTA DE VEHICULO 1.6 SCE 114 2WD - Color: - Implicacion: No definido -\nObservaciones: Version: PICK-UP CABINA DOBLE...COLOR GRIS\n Apellido: SANTILLAN - Nombre: Gabriel Roberto - Alias: - Sexo:\nMASCULINO - Edad: 58 - DNI: 18171020 - Fecha Nac: 1967.04.21 -\n 07/05 18:04:08   rbarcelona   EDICION DE PERSONA\nImplicacion: Damnificado/a - LP: 0 - Observaciones: PERSONAL\nPOLICIAL RETIRADO DE PROVINCIA, LP 129448...\n OF LP 36047 CORINI FACUNDO, JUSGADO NACIONAL CRIMINAL\n 07/05 18:04:32   rbarcelona   COMENTARIO Y CORRECCIONAL N 16 A/C DR ITURRALDE SECRETARIA N 111\nA/C DRA TURCONI, ACT POR HURTO ...\nRecurso [HT169 (HANDY)] liberado (Liberado por cierre de\n 07/05 18:05:33   rbarcelona   LIBERACION DE RECURSO  \nsuceso)\n Móvil [609B (CV09B (7828))] Personal [ INS: MALDONADO,\n 07/05 18:05:34   rbarcelona   LIBERACION DE MOVIL NAHUEL NAZARENO; OF1: LASCANO, MARIANO JOSE LUIS]\nliberado (Liberado por cierre de suceso)\n Agencia: COMUNA 9 Tipo/Subtipo: ROBO\n 07/05 18:05:34   rbarcelona   DESPACHO EN ESPERA DE CIERRE (RECIENTE/CONSUMADO) Prioridad: MEDIA Resultado de cierre:\nACT. POR HURTO\nAgencia: VIDEO Tipo/Subtipo: ROBO (RECIENTE/CONSUMADO)\n 07/05 18:05:56   fberardi   CIERRE DESPACHO  \nPrioridad: MEDIA Resultado de cierre: CARTA NOTIFICADA\n Agencia: COMUNA 9 Tipo/Subtipo: ROBO\n 07/05 18:22:55   jvelazquez   CIERRE DESPACHO (RECIENTE/CONSUMADO) Prioridad: MEDIA Resultado de cierre:\nACT. POR HURTO\n Agencia: CMU CABA Tipo/Subtipo: ROBO\n 07/05 19:07:57   evera   CIERRE DESPACHO (RECIENTE/CONSUMADO) Prioridad: MEDIA Resultado de cierre:\nCARTA NOTIFICADA"
            }
          ]
        },
        {
          "role": "system",
          "content": [
            {
              "type":"text",
              "text": "{\n  \"number\": \"45113573\",\n  \"eventDate\": \"2025-05-07\",\n  \"callTime\": \"15:46:52\",\n  \"jurisdiction\": \"COMISARIA VECINAL 9B\",\n  \"justice\": \"Juzgado Nacional Criminal y Correccional N 16\",\n  \"fiscal\": \"Dr. Iturralde\",\n  \"secretariat\": \"Dra. Turconi\",\n  \"direction\": \"Av. Rivadavia 10615\",\n  \"review\": \"Personal policial tomó conocimiento mediante un llamado de un masculino quien refirió que a su cliente, identificado como Gabriel Roberto Santillán, masculino, 58 años, personal policial retirado de la Policía de la Ciudad, le habrían sustraído un bolso con pertenencias varias desde el interior de su vehículo Renault Oroch dominio AG071IZ. El damnificado manifestó que al momento del hecho el rodado fue inhibido electrónicamente. Inicialmente se indicó la posible sustracción de un arma reglamentaria, sin embargo, posteriormente se confirmó que no fue sustraída, resultando el hurto sólo de efectos personales. Se estableció que los autores serían dos masculinos a bordo de una Renault Kangoo color gris sin chapa patente colocada y con portaequipaje, quienes se dieron a la fuga en sentido hacia Villa Luro. En el lugar se hicieron presentes móviles policiales HT169 y 609B. El Centro de Monitoreo Urbano informó que a través de las cámaras ubicadas en Liniers21, Liniers11 y Liniers23 no se captaron imágenes relevantes para la investigación. El hecho fue caratulado como hurto, interviniendo el Juzgado Nacional Criminal y Correccional N 16 a cargo del Dr. Iturralde, Secretaría N 111 a cargo de la Dra. Turconi, quienes ordenaron las actuaciones correspondientes.\"\n}"
            }
          ]
        },
        { role: "user", content: body },],
    });

    const reply = completion.choices[0]?.message?.content;
    return NextResponse.json({ response: reply });
  } catch (error) {
    console.error('Error al generar respuesta con OpenAI:', error);
    return NextResponse.json(
      { error: 'Hubo un error al generar la respuesta' },
      { status: 500 }
    );
  }
}